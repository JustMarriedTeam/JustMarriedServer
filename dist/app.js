"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function setupAuth(){app.use(_passport2.default.initialize())}function swaggerize(){app.use((0,_swaggerizeExpress2.default)({api:require("./api.json"),docspath:"/api-docs",handlers:"./handlers",security:"./security"}))}function configureOthers(){app.use(_bodyParser2.default.json()),app.use(_bodyParser2.default.urlencoded({extended:!0})),app.use((0,_cookieParser2.default)()),app.use((0,_compression2.default)()),app.use((0,_methodOverride2.default)()),app.use((0,_helmet2.default)()),app.use((0,_cors2.default)())}function configureNotFoundBehaviour(){app.use(function(e,r,s){var t=new _APIError2.default("API not found",_httpStatus2.default.NOT_FOUND);return s(t)})}function configureErrorHandling(){app.use(function(e,r,s,t){if(e instanceof _expressValidation2.default.ValidationError){var o=e.errors.map(function(e){return e.messages.join(". ")}).join(" and "),i=new _APIError2.default(o,e.status,!0);return t(i)}if(!(e instanceof _APIError2.default)){var u=new _APIError2.default(e.message,e.status,e.isPublic);return t(u)}return t(e)})}function initializeLogging(){"development"===env&&(app.use((0,_morgan2.default)("dev")),_expressWinston2.default.requestWhitelist.push("body"),_expressWinston2.default.responseWhitelist.push("body"),app.use(_expressWinston2.default.logger({winstonInstance:_logger2.default,meta:!0,msg:"HTTP {{req.method}} {{req.url}} {{res.statusCode}} {{res.responseTime}}ms",colorStatus:!0}))),"test"!==env&&app.use(_expressWinston2.default.errorLogger({winstonInstance:_logger2.default}))}function mountApi(){}Object.defineProperty(exports,"__esModule",{value:!0});var _express=require("express"),_express2=_interopRequireDefault(_express),_morgan=require("morgan"),_morgan2=_interopRequireDefault(_morgan),_bodyParser=require("body-parser"),_bodyParser2=_interopRequireDefault(_bodyParser),_cookieParser=require("cookie-parser"),_cookieParser2=_interopRequireDefault(_cookieParser),_compression=require("compression"),_compression2=_interopRequireDefault(_compression),_methodOverride=require("method-override"),_methodOverride2=_interopRequireDefault(_methodOverride),_cors=require("cors"),_cors2=_interopRequireDefault(_cors),_httpStatus=require("http-status"),_httpStatus2=_interopRequireDefault(_httpStatus),_expressWinston=require("express-winston"),_expressWinston2=_interopRequireDefault(_expressWinston),_expressValidation=require("express-validation"),_expressValidation2=_interopRequireDefault(_expressValidation),_helmet=require("helmet"),_helmet2=_interopRequireDefault(_helmet),_logger=require("./logger"),_logger2=_interopRequireDefault(_logger),_APIError=require("./helpers/APIError"),_APIError2=_interopRequireDefault(_APIError),_swaggerizeExpress=require("swaggerize-express"),_swaggerizeExpress2=_interopRequireDefault(_swaggerizeExpress),_passport=require("passport"),_passport2=_interopRequireDefault(_passport),app=(0,_express2.default)(),env=process.env.env;initializeLogging(),configureOthers(),setupAuth(),mountApi(),swaggerize(),configureErrorHandling(),configureNotFoundBehaviour(),exports.default=app,module.exports=exports.default;